"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=createSharedElementStackNavigator;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var React=_interopRequireWildcard(require("react"));var _native=require("@react-navigation/native");var _stack=require("@react-navigation/stack");var _SharedElementRendererProxy=require("./SharedElementRendererProxy");var _SharedElementRendererContext=_interopRequireDefault(require("./SharedElementRendererContext"));var _SharedElementRendererView=_interopRequireDefault(require("./SharedElementRendererView"));var _SharedElementRendererData=_interopRequireDefault(require("./SharedElementRendererData"));var _createSharedElementScene=_interopRequireDefault(require("./createSharedElementScene"));var _jsxFileName="/Users/hein/repos/react/react-navigation-sharedelement/src/createSharedElementStackNavigator.tsx";var _navigatorId=1;function createSharedElementStackNavigator(options){var navigatorId=options&&options.name?options.name:"stack".concat(_navigatorId);_navigatorId++;var rendererDataProxy=new _SharedElementRendererProxy.SharedElementRendererProxy();function SharedElementStackNavigator(_ref){var initialRouteName=_ref.initialRouteName,children=_ref.children,screenOptions=_ref.screenOptions,rest=(0,_objectWithoutProperties2.default)(_ref,["initialRouteName","children","screenOptions"]);var _useNavigationBuilder=(0,_native.useNavigationBuilder)(_native.StackRouter,{initialRouteName:initialRouteName,children:children,screenOptions:screenOptions}),state=_useNavigationBuilder.state,descriptors=_useNavigationBuilder.descriptors,navigation=_useNavigationBuilder.navigation;var rendererDataRef=React.useRef(null);return React.createElement(_SharedElementRendererContext.default.Consumer,{__source:{fileName:_jsxFileName,lineNumber:67}},function(rendererData){if(!rendererData){rendererDataRef.current=rendererDataRef.current||new _SharedElementRendererData.default();rendererDataProxy.source=rendererDataRef.current;}else{rendererDataProxy.source=rendererData;}return React.createElement(_SharedElementRendererContext.default.Provider,{value:rendererDataProxy,__source:{fileName:_jsxFileName,lineNumber:79}},React.createElement(_stack.StackView,(0,_extends2.default)({},rest,{state:state,navigation:navigation,descriptors:descriptors,__source:{fileName:_jsxFileName,lineNumber:80}})),rendererDataRef.current?React.createElement(_SharedElementRendererView.default,{rendererData:rendererDataRef.current,__source:{fileName:_jsxFileName,lineNumber:87}}):undefined);});}var navigatorFactory=(0,_native.createNavigatorFactory)(SharedElementStackNavigator);var _navigatorFactory=navigatorFactory(),Navigator=_navigatorFactory.Navigator,Screen=_navigatorFactory.Screen;function wrapComponent(component){return(0,_createSharedElementScene.default)(component,rendererDataProxy,_stack.CardAnimationContext,navigatorId);}function wrapScreen(_){return null;}function getSharedElementsChildrenProps(children){return React.Children.toArray(children).reduce(function(acc,child){if(React.isValidElement(child)){if(child.type===wrapScreen){acc.push(child.props);}if(child.type===React.Fragment){acc.push.apply(acc,(0,_toConsumableArray2.default)(getSharedElementsChildrenProps(child.props.children)));}}return acc;},[]);}function WrapNavigator(props){var children=props.children,rest=(0,_objectWithoutProperties2.default)(props,["children"]);var componentMapRef=React.useRef(new Map());var screenChildrenProps=getSharedElementsChildrenProps(children);return React.createElement(Navigator,(0,_extends2.default)({},rest,{__source:{fileName:_jsxFileName,lineNumber:164}}),screenChildrenProps.map(function(_ref2){var component=_ref2.component,sharedElementsConfig=_ref2.sharedElementsConfig,childrenProps=(0,_objectWithoutProperties2.default)(_ref2,["component","sharedElementsConfig"]);if(sharedElementsConfig)component.sharedElements=sharedElementsConfig;if(!componentMapRef.current.has(component)){componentMapRef.current.set(component,wrapComponent(component));}var wrappedComponent=componentMapRef.current.get(component);return React.createElement(Screen,(0,_extends2.default)({key:childrenProps.name},childrenProps,{component:wrappedComponent,__source:{fileName:_jsxFileName,lineNumber:177}}));}));}return{Navigator:WrapNavigator,Screen:wrapScreen};}
//# sourceMappingURL=createSharedElementStackNavigator.js.map